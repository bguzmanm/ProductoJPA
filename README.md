# Ejemplo de implementación JPA Spring Framework

## 25 de Enero

- Incluimos dependencias en POM.xml: Oracle JDBC, spring-data-jpa, spring-tx, javax.persistence-api, hibernate-core y spring-orm.
- Configuramos root-context.xml, incluyendo la creación del entityManagerFactory y el transactionManager.
- Creamos Repositorio para Productos.
- Consumimos desde controller.

## 27 de Enero
- Incluimos Entity Class para Categoría.
- Establecemos asociación @ManyToOne entre Producto y Categoería.
- Mostramos lista de productos y su categoría.

## 29 de Enero
- Incluimos servicio REST que retorna la lista de productos
- Incluimos servicio REST que retorna un producto.
- Incluimos dependencia a Jackson y org.json.

# BD de ejemplo
Utilizaremos la BD de ejemplo provista por Oracle, la que puedes descagar desde este [link](https://www.oracletutorial.com/getting-started/oracle-sample-database/). Una vez la descagues, verás estos 4 archivos.

```sql
ot_create_user.sql
ot_data.sql
ot_drop.sql
ot_schema.sql
```

Con ellos, debes realizar los siguientes pasos:

Abre SQLDeveloper, y conectate con tu usuario system.
Abre el archivo ot_create_user.sql, y ejecútalo. Con eso crearás al usuario OT.
Crea una nueva conexión en SQLDeveloper, pero esta vez conectate con el usuario OT.
Abre el archivo ot_schema.sql utilizando tu nueva conexión con el usuario OT.
El archivo ot_schema tiene el DDL para crear las tablas de la base de datos. Sin embargo, este script tiene instrucciones que no son compatibles con la versión 11g, por lo que hay que hacer una pequeña corrección.

```sql
CREATE TABLE regions 
(
  region_id NUMBER GENERATED BY DEFAULT AS IDENTITY
  START WITH 5 PRIMARY KEY,
  region_name VARCHAR2( 50 ) NOT NULL
 );
```

Si te fijas, hay una sección que dice `GENERATED BY DEFAULT AS IDENTITY START WITH 5`
Lo que dice es que dicho campo, debe ser generado por defecto como identity (es decir, un número autogenerado que comenzará en el número 5.
Hay otras tablas que también lo tienen, pero el número de inicio es distinto. Toda esa sección debes eliminarla. Entonces, la tabla regions quedaría así:

```sql
CREATE TABLE regions 
(
  region_id NUMBER PRIMARY KEY,
  region_name VARCHAR2( 50 ) NOT NULL
 );
```

Bien. Debes repetir eso con todas las tablas que tengan el IDENTITY definido.

6. Ejecuta el script y crea las tablas de la BD.
7. Abre el archivo ot_data.sql, siempre utilizando la conección con el usuario OT.
8. Este archivo contiene una serie de instrucciones DML para insertar datos en nuestra base de datos, pero que debes modificar antes de ejecutarlo. La razón? porque seguramente tienes la configuración regional de tu Sistema Operativo en Chile, y los formatos de fechas son distintos. Para dejarlo pulento, fijate que algunas tablas manejan campos de fechas, y en los INSERT aparece algo así:

```sql
Insert into EMPLOYEES (EMPLOYEE_ID,FIRST_NAME,LAST_NAME,EMAIL,PHONE,HIRE_DATE,MANAGER_ID,JOB_TITLE) values (107,'Summer','Payne','summer.payne@example.com','515.123.8181',to_date('07-JUN-16','DD-MON-RR'),106,'Public Accountant');
```

La instrucción to_date('07-JUN-16','DD-MON-RR') , le da formato al texto, y es lo que debemos cambiar a nuestra locación. Para ello, debes reemplazar el JUN, que corresponde al mes, por el mes correspondiente a su número. Es decir, JUN es Junio, es decir, el més 06. Lo mismo debes hacer con los otros 11 meses.
Luego, debes reemplazar los el texto MON por MM, y ya está. Recuerda hacer los cambios MASIVOS a todo el archivo. Si, hay nombres que se modificarán, pero da igula que el Empleado que se llama Julio ahora se llame 07io, y que Monica, ahora se llame MMica.
9. Ejecuta el script y ve la magia.
10. Si tienes problemas en algún paso, puedes ejecutar el archivo ot_drop.sql, el que borra las tablas y todo para que comiences de nuevo.


Suerte!!